var _=Object.defineProperty;var C=(i,t,e)=>t in i?_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var f=(i,t,e)=>C(i,typeof t!="symbol"?t+"":t,e);import{$ as b,e as T}from"./index-CHk-AC9J.js";const m=new WeakMap;function P(i,t){let e=t;for(;e;){if(m.get(e)===i)return!0;e=Object.getPrototypeOf(e)}return!1}function k(i){return t=>{if(P(i,t))return t;const e=i(t);return m.set(e,i),e}}const p={static:{forwardsIn:"static",forwardsOut:"static",backwardsIn:"static",backwardsOut:"static"},fade:{forwardsIn:"fadeIn",forwardsOut:"fadeOut",backwardsIn:"fadeIn",backwardsOut:"fadeOut"},horizontal:{forwardsIn:"moveFromRight",forwardsOut:"moveToLeft",backwardsIn:"moveFromLeft",backwardsOut:"moveToRight"},horizontalEverForwards:{forwardsIn:"moveFromRight",forwardsOut:"moveToLeft",backwardsIn:"moveFromRight",backwardsOut:"moveToLeft"},horizontalEverBackwards:{forwardsIn:"moveFromLeft",forwardsOut:"moveToRight",backwardsIn:"moveFromLeft",backwardsOut:"moveToRight"},verticalDownForwards:{forwardsIn:"static",forwardsOut:"moveToBottom",backwardsIn:"moveFromLeft",backwardsOut:"moveToRight"},verticalDownBackwards:{forwardsIn:"moveFromRight",forwardsOut:"moveToLeft",backwardsIn:"static",backwardsOut:"moveToBottom"},verticalUpForwards:{forwardsIn:"moveFromBottom",forwardsOut:"static",backwardsIn:"moveFromLeft",backwardsOut:"moveToRight"},verticalUp:{forwardsIn:"moveFromBottom",forwardsOut:"static",backwardsIn:"static",backwardsOut:"moveToBottom"}};function O(i,t){return[...t.parentElement.children].filter(e=>e!==t).find(e=>e.getAttribute("state")===i||e.state===i)}function h(i){i.removeAttribute("page-animation"),i.removeAttribute("page-animation-direction"),i.removeEventListener("animationend",i._animCb),i.removeEventListener("animationcancel",i._animCb)}function g(i){var e;const t=(e=i._isPreviousNavigationFor)==null?void 0:e.page;i._isPreviousNavigationFor=null,t&&g(t)}function w(i){i.dispatchEvent(new CustomEvent("page-active",{bubbles:!0,composed:!0}))}function v(i,t,e){t.eventPhase===2&&(h(i),!i.hasAttribute("page-animation")&&!e.hasAttribute("page-animation")&&requestAnimationFrame(()=>{const r=i.state==="active"?i:e;w(r)}))}function B(i,t){i._animCb=e=>v(i,e,t),i.addEventListener("animationend",i._animCb),i.addEventListener("animationcancel",i._animCb),t._animCb=e=>v(t,e,i),t.addEventListener("animationend",t._animCb),t.addEventListener("animationcancel",t._animCb)}function E(i,t,e){return(e==null?void 0:e[t])||p.static}function d(i,t,e,r){i.setAttribute("page-animation",t),i.setAttribute("page-animation-direction",e),r&&i.dispatchEvent(new CustomEvent(`animation-${e}`,{bubbles:!0,composed:!0}))}function F(i,t,e,r){let n=!1,o=e,s=r;t&&i._isPreviousNavigationFor?(o=i._isPreviousNavigationFor.type,s=i._isPreviousNavigationFor.animations,g(i),n=!0):t._isPreviousNavigationFor={page:i,type:e,animations:r},B(i,t);const a=E(i,o,s);requestAnimationFrame(()=>{n?(d(i,a.backwardsIn,"backward"),d(t,a.backwardsOut,"backward",!0)):(d(i,a.forwardsIn,"forward"),d(t,a.forwardsOut,"forward",!0))})}function I(i,{disabled:t,type:e,animations:r}={}){h(i);const n=O("inactive",i);n&&!t?(h(n),F(i,n,e,r)):w(i)}const A=i=>{var t;return t=class extends i{get _pageTransitions(){return this.constructor.pageTransitionDefinitions}constructor(){super(),this.pageTransitionType="fade",this.pageTransitionDisabled=!1}connectedCallback(){super.connectedCallback(),this.dataset.cellsPage=""}updated(e){var r;(r=super.updated)==null||r.call(this,e),e.has("state")&&this.state==="active"&&I(this,{disabled:this.pageTransitionDisabled,type:this.pageTransitionType,animations:this._pageTransitions})}},f(t,"properties",{state:{reflect:!0},pageTransitionType:{attribute:"page-transition-type"},pageTransitionDisabled:{type:Boolean,attribute:"page-transition-disabled"}}),f(t,"pageTransitionDefinitions",{...p}),t},j=k(A),S={};class y{__callBridge(...t){const[e,...r]=t;let n;if(b){if(!b[e])throw new Error(`WARNING: Invalid cells bridge command execution: ${e}.`);return n=b[e](...r),n}return T(e,r),n}registerService(t,e){this.services[t]=e}constructor(){this.services=S;const t=this;this.registerService("subscribe",function(e,r){return t.__callBridge("registerInConnection",e,this,r)}),this.registerService("unsubscribe",function(e){return t.__callBridge("unsubscribe",e,this)}),this.registerService("publish",function(e,r,n={}){return t.__callBridge("publish",e,r,n)}),this.registerService("publishOn",function(e,r,n){return t.__callBridge("registerOutConnection",e,r,n)}),this.registerService("navigate",function(e,r){return t.__callBridge("navigate",e,r)}),this.registerService("updateInterceptorContext",function(e){return t.__callBridge("updateInterceptorContext",e)}),this.registerService("resetInterceptorContext",function(){return t.__callBridge("resetInterceptorContext")}),this.registerService("getInterceptorContext",function(){return t.__callBridge("getInterceptorContext")}),this.registerService("setInterceptorContext",function(e){return t.__callBridge("setInterceptorContext",e)}),this.registerService("getCurrentRoute",function(){return t.__callBridge("getCurrentRoute")}),this.registerService("updateSubroute",function(e){return t.__callBridge("updateSubroute",e)})}_plugCellsCore(t,e=!0){Object.entries(this.services).forEach(function([r,n]){t[r]=e?n.bind(t):n})}_plugCellsCoreToPrototype(t,e=!0){Object.entries(this.services).forEach(function([r,n]){Object.defineProperty(t.prototype,r,{value:e?n.bind(t):n,writable:!0,configurable:!0})})}addCellsCoreToPrototype(t){_plugCellsCoreToPrototype(t,!1)}}function x(i){return new y()._plugCellsCore(i,!1),i}class D{constructor(t){this.subscriptions=[],x(this),this.subscribe=this.subscribe.bind(t),this.unsubscribe=this.unsubscribe.bind(t),this.publish=this.publish.bind(t),(this.host=t).addController(this),this._definedBoundedProperties()}_definedBoundedProperties(){const t=this.host.constructor.inbounds,e=this.host.constructor.outbounds;if(!t&&!e)return;const r=this._mergeBounds(t,e);Object.keys(r).forEach(n=>{let{output:o,input:s,skipUpdate:a,action:u}=r[n];this._inOut(n,o,s,a,u)})}_mergeBounds(t={},e={}){const r=[];return Object.keys(t).forEach(n=>{const{channel:o,skipUpdate:s,action:a}=t[n];r[n]={input:o,skipUpdate:s,action:a}}),Object.keys(e).forEach(n=>{const{channel:o}=e[n];let s=r[n]||{};r[n]={...s,output:o}}),r}_inOut(t,e,r,n=!1,o){let s,a=c=>{s=c,this.publish(e,c)},u=()=>s,l;o&&typeof o=="function"?l=c=>{s=o(c),n||this.host.requestUpdate()}:l=c=>{s=c,n||this.host.requestUpdate()},this.subscriptions.push({channel:r,action:l}),e?Object.defineProperties(this.host,{[t]:{get:u,set:a}}):Object.defineProperties(this.host,{[t]:{get:u}})}hostConnected(){for(const t of this.subscriptions)this.subscribe(t.channel,t.action)}hostDisconnected(){for(const t of this.subscriptions)this.unsubscribe(t.channel)}}export{D as E,j as P,k as d,x as p};
